<div class="dice-game-container">
  <h1>üé≤ Multiplayer Dice Roller üé≤</h1>

  @if (!joined) {
    <div class="join-section">
      <input [(ngModel)]="myName" placeholder="Enter your name" />
      <button (click)="joinGame()">Join Game</button>
    </div>
  }

  @if (joined) {
    <div class="game-section">
      @if (joinError) {
        <div class="error-message">{{ joinError }}</div>
      }
      <div class="players-list">
        <h2>Players</h2>
        <ul>
          @for (player of players; track player.id) {
            <li>
              <span [ngClass]="{'me': player.id === myId}">{{ player.name }}
                @if (player.id === myId) {
                  <span>(You)</span>
                }
              </span>
            </li>
          }
        </ul>
      </div>

      @if (!roundActive && isFirstPlayer()) {
        <div class="rounds-input">
          <label>Number of rounds:
            <input type="number" min="1" [(ngModel)]="totalRounds" (focus)="roundsInputFocused = true" (blur)="roundsInputFocused = false" />
          </label>
        </div>
      }
      @if (startingRoundText) {
        <div class="starting-round-text">{{ startingRoundText }}</div>
      }
      <div class="actions">
        <button (click)="startRound()" [disabled]="roundActive || !isFirstPlayer() || isStartingRound || roundsInputFocused">Start New Round</button>
        <button (click)="rollDice()" [disabled]="!canRoll()">Roll Dice</button>
      </div>

      @if (roundActive) {
        <div class="turn-section">
          @if (currentTurnId === myId) {
            <h3>Your turn! Roll now <span *ngIf="turnCountdown">({{ turnCountdown }})</span></h3>
          }
          @if (currentTurnId !== myId) {
            <h3>Waiting for {{ getCurrentTurnName() }} to roll... <span *ngIf="turnCountdown">({{ turnCountdown }})</span></h3>
          }
        </div>
      }

      @if (roundActive) {
        <div class="rolling-section">
          <h3>Rolling... Waiting for all players!</h3>
          <div class="dice-list">
            @for (player of players; track player.id) {
              <div class="dice-player">
                <span>{{ player.name }}</span>
                <div class="dice" [ngClass]="{'me': player.id === myId}">
                  @if (hasRolled(player.id)) {
                    <span>{{ getRoll(player.id) }}</span>
                  }
                  @if (!hasRolled(player.id)) {
                    <span>?</span>
                  }
                </div>
              </div>
            }
          </div>
        </div>
      }

      @if (currentRound > 0) {
        <div class="round-info">
          <b>Round {{ currentRound }} / {{ totalRounds }}</b>
        </div>
      }

      @if (!roundActive && winners.length && currentRound === totalRounds) {
        <div class="final-scores">
          <h2>üèÖ Final Scores üèÖ</h2>
          <ul>
            @for (player of players; track player.id) {
              <li>
                {{ player.name }}: {{ scores[player.id] || 0 }}
              </li>
            }
          </ul>
          <h3>üèÜ Winner{{ getFinalWinners().length > 1 ? 's' : '' }}: {{ getFinalWinnerNames() }} üèÜ</h3>
        </div>
      }
      @if (!roundActive && players.length > 1 && !isFirstPlayer()) {
        <div class="waiting-message">
          Waiting for <b>{{ players[0].name || 'Unknown' }}</b> to start the game...
        </div>
      }
    </div>
  }
</div>
